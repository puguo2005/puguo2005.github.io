(window.webpackJsonp=window.webpackJsonp||[]).push([[19,541,544],{1766:function(t,e,s){"use strict";s.r(e);var i={props:{type:{type:Number},multiple:{type:Boolean,default:!0},acceptType:{type:Array,default:()=>[]},buttonText:{type:String,default:"选择文件"},title:{type:String},desc:{type:String},fileList:{type:Array,default:()=>[]},onFileChange:{type:Function,default:()=>{}},onBeforeUpload:{type:Function,default:()=>{}},onUploadSuccess:{type:Function,default:()=>{}},onUploadError:{type:Function,default:()=>{}}},data:()=>({}),computed:{accept(){return this.acceptType.join(",")},isLogin(){return!!this.$store.state.token}},methods:{handleClick(){this.$refs.convertUploader.$el.querySelector("input").click()},handleDropEvent(t){this.isLogin||(t.preventDefault(),t.stopPropagation())},clearFiles(){this.$refs.convertUploader.clearFiles()},onChooseClick(){this.postCollection({1:"img-convert_add_img",2:"video-convert_add_video",3:"audio-convert_add_audio",4:"doc-convert_add_doc"}[this.type])}}},a=(s(2293),s(0)),l=Object(a.a)(i,(function(){var t=this,e=t._self._c;return e("el-upload",{ref:"convertUploader",attrs:{action:"#",drag:!0,"auto-upload":!1,"show-file-list":!1,multiple:t.multiple,accept:t.accept,"file-list":t.fileList,"before-upload":t.onBeforeUpload,"on-change":t.onFileChange,"on-success":t.onUploadSuccess,"on-error":t.onUploadError}},[e("div",{staticClass:"upload-container h-110 flex flex-col justify-center items-center",on:{drop:t.handleDropEvent,click:t.onChooseClick}},[t._t("icon"),t._v(" "),e("p",{staticClass:"text-normal-c333 text-center text-base mb-4"},[t._v(t._s(t.title))]),t._v(" "),e("p",{staticClass:"text-normal-c999 text-center text-sm mb-4"},[t._v(t._s(t.desc))]),t._v(" "),e("p",{staticClass:"text-normal-c999 text-center text-sm mb-4"},[t._v("最大文件：500MB")]),t._v(" "),e("el-button",{staticClass:"choose-btn",attrs:{type:"primary"}},[e("i",{staticClass:"el-icon-circle-plus-outline text-2xl mr-3"}),t._v("\n      "+t._s(t.buttonText)+"\n    ")])],2)])}),[],!1,null,"3d4e9912",null);e.default=l.exports},1785:function(t,e,s){"use strict";var i=s(3),a=s(27),l=s(4),o=s(84),n=s(6),r=s(2643);const c=s(1148),h=s(1144);e.a={mixins:[a.a],data:()=>({fileList:[],qnUrl:"https://upload-cn-east-2.qiniup.com",qnData:{key:"",token:""},aliData:{region:"",accessKeyId:"",accessKeySecret:"",securityToken:"",expiration:"",bucket:"",endPoint:""},convertTimer:{},taskTimer:{},convertDone:!1,converting:!1,availCount:0,failCount:0,successCount:0,limitInfo:{}}),computed:{isLogin(){return!!this.$store.state.token}},watch:{isLogin:{handler(t){t&&(this.$store.state.user.uid||this.getUserData())},immediate:!0}},methods:{onBeforeUpload(t){},onFileChange(t,e){this.fileList=e,t.ext=Object(o.f)(t.name);const s=Object(l.c)(t.name);s&&(t.name=s),this.setFileConvertType(t),this.setFileStatus(t,"ready"),this.checkFileSizeLimit(t)},onRemoveFile(t){const e=this.fileList.findIndex((e=>e.uid===t.uid));-1!==e&&this.fileList.splice(e,1)},setFileConvertType(t){const e=this.fileList.findIndex((e=>e.uid===t.uid));let s=t.ext;s=this.type===n.a.VIDEO?"mp4":this.type===n.a.AUDIO?"mp3":this.type===n.a.FILE?"pdf"===t.ext?"txt":"pdf":this.getAvaliableConvertType(t)[0],-1!==e&&this.$set(this.fileList[e],"format",s)},checkFileSizeLimit(t){Object(o.a)(t.size,500)||this.setFileStatus(t,"limit")},getAvaliableConvertType(t){return this.convertType.filter((e=>e!==t.ext))},onUploadSuccess(){},onUploadError(t,e){Object(i.b)("上传失败",t,e)},async toConvert(){if(this.postCollection({1:"img-convert_go_convert",2:"video-convert_go_convert",3:"audio-convert_go_convert",4:"doc-convert_go_convert"}[this.type]),!this.isLogin)return void document.dispatchEvent(new Event("the-header:show-login"));const{data:t}=await this.$axios.get(`/v1/format/getLimit?eacb=${this.$store.state.token}`);1===t.status&&(this.limitInfo=t.result);let e=!1,s=2;const{use:a,limit:o}=this.limitInfo;if(Object(i.b)("转换限制信息",this.limitInfo,this.isVip,this.fileList.length),!this.isVip&&this.fileList.length+a>o&&(e=!0),this.isVip&&this.fileList.length+a>o&&(e=!0,s=1),e){const t=Object(l.e)(r.default,{type:s,levelUp:()=>{this.$showBuyVipDialog({dialogType:2,level:this.appVipLevel})},onClose:()=>{t.remove()}})}else if(this.converting=!0,this.availCount=this.fileList.filter((t=>"ready"===t.status)).length,this.type===n.a.IMAGE||this.type===n.a.FILE){await this.getAliToken();for(let t=0;t<this.fileList.length;t++)if("ready"===this.fileList[t].status){this.setFileStatus(this.fileList[t],"uploading");try{const{url:e,key:s}=await this.handleAliMultiUpload(this.fileList[t]);if(e){const i=e.replace(/[?&]uploadId=[^&]*&?/g,"");this.setFileStatus(this.fileList[t],"uploaded"),this.$set(this.fileList,t,{...this.fileList[t],upload_url:i,oss_key:s}),this.$nextTick((()=>{this.createConvertTask(this.fileList[t],t)}))}}catch(e){this.onUploadError(e,this.fileList[t])}}}else{await this.getQnToken();for(let t=0;t<this.fileList.length;t++){const e=this.fileList[t];"ready"===e.status&&(this.setFileStatus(e,"uploading"),this.uploadFile(e,t))}}},uid(){return"tools-convert/"+this.$store.state.user.uid+"/"},posterUid(){return"tools-convert/"+this.$store.state.user.uid+"/c_"},randomStr(){let t="";for(let e=0;e<10;e++){t+=parseInt(10*Math.random())}return t},getFilePath(t,e){const s=parseInt(Date.now()/1e3).toString(),i=this.randomStr();return`tools-convert/${e}/${this.$store.state.user.uid}/`+s+"_"+i+"_"+t},async getQnToken(){const t=this.$store.state.token,e=await this.$axios.get(`/v1/getQiniuTokenQr?eacb=${t}`);this.qnData.token=e.data.result.token},async getAliToken(){const t=await this.$axios.get("/v1/filePre/getStsToken?gt=1");this.aliData=t.data.result},uploadFile(t,e){const s=parseInt(Date.now()/1e3).toString(),a=this.randomStr(),l=(t.uidPath||this.uid())+s+"_"+a+"_"+t.name;return((t,e,s,i={})=>h.upload(t,e,s,{},{}).subscribe(i))(t.raw,l,this.qnData.token,{next:t=>{Object(i.b)("上传进度",t),this.$set(this.fileList,e,{...this.fileList[e],percentage:Math.floor(t.total.percent)})},complete:s=>{Object(i.b)("上传文件成功",s),this.setFileStatus(t,"uploaded"),this.$set(this.fileList,e,{...this.fileList[e],upload_url:s.key}),this.$nextTick((()=>{this.createConvertTask(this.fileList[e],e)}))},error:e=>{Object(i.b)("上传文件失败",e),this.setFileStatus(t,"failed"),this.failCount+=1}})},createConvertTask(t,e){Object(i.b)("创建转换任务",t,e),this.$axios.post("/v1/format/addTask",{eacb:this.$store.state.token,type:this.type,base_path:this.type===n.a.FILE?t.oss_key:t.upload_url,result_path:this.type===n.a.IMAGE?`${t.upload_url.replace("https://bmw-file.oss-cn-shanghai.aliyuncs.com","https://bmw-tool-pic.bmwax.cn")}?x-oss-process=image/format,${t.format}`:"",format_type:t.format,base_type:t.ext,size:t.size,file_name:t.name}).then((s=>{1===s.data.status&&s.data.result?(this.$set(this.fileList,e,{...this.fileList[e],task_id:s.data.result}),this.setFileStatus(t,"convert"),this.getConvertTaskStatus(this.fileList[e]),this.startConvertTimer(this.fileList[e])):(this.$message.error(s.data.msg),this.failCount+=1)})).catch((t=>{this.$message.error(t.data.msg),this.failCount+=1}))},getConvertTaskStatus(t){Object(i.b)("获取转换任务状态",t),this.$axios.get("/v1/format/getTaskStatus",{params:{eacb:this.$store.state.token,task_id:t.task_id}}).then((e=>{if(1===e.data.status){const{result_path:s,status:i}=e.data.result||{};if(0===i)this.taskTimer[t.uid]&&(clearTimeout(this.taskTimer[t.uid]),delete this.taskTimer[t.uid]),this.taskTimer[t.uid]=setTimeout((()=>{this.getConvertTaskStatus(t)}),2e3);else{if(this.taskTimer[t.uid]&&(clearTimeout(this.taskTimer[t.uid]),delete this.taskTimer[t.uid]),1===i){this.setFileStatus(t,"success"),this.convertTimer[t.uid]&&(clearInterval(this.convertTimer[t.uid]),delete this.convertTimer[t.uid]);const e=this.fileList.findIndex((e=>e.uid===t.uid));this.$set(this.fileList,e,{...this.fileList[e],result_path:s}),this.successCount+=1}2===i&&(this.convertTimer[t.uid]&&(clearInterval(this.convertTimer[t.uid]),delete this.convertTimer[t.uid]),this.setFileStatus(t,"failed"),this.failCount+=1)}}})).catch((t=>{Object(i.b)("获取转换任务状态失败",t),this.$message.error(t.data.msg)})).finally((()=>{this.failCount+this.successCount===this.availCount&&(this.converting=!1,this.convertDone=!0)}))},startConvertTimer(t){const e=this.fileList.findIndex((e=>e.uid===t.uid));this.$set(this.fileList,e,{...this.fileList[e],percentage:0});let s=0;this.convertTimer[t.uid]=setInterval((()=>{s<99&&(s+=Math.floor(10*Math.random()),s>99&&(s=99)),this.$set(this.fileList,e,{...this.fileList[e],percentage:s})}),1e3)},handleAliUpload(t){return new Promise((async(e,s)=>{try{const i=new c({region:this.aliData.region,accessKeyId:this.aliData.accessKeyId,accessKeySecret:this.aliData.accessKeySecret,stsToken:this.aliData.securityToken,bucket:this.aliData.bucket,endpoint:this.aliData.endPoint,secure:!0,internal:!1}),a=this.getFilePath(t.name,"convertFile"),{res:l,url:o}=await i.put(a,t,{headers:{"x-oss-storage-class":"Standard"}});200==l.status?e({url:o,key:a}):s()}catch(t){s(t)}}))},handleAliMultiUpload(t){return new Promise((async(e,s)=>{try{const a=new c({region:this.aliData.region,accessKeyId:this.aliData.accessKeyId,accessKeySecret:this.aliData.accessKeySecret,stsToken:this.aliData.securityToken,bucket:this.aliData.bucket,endpoint:this.aliData.endPoint,secure:!0,internal:!1}),l=this.getFilePath(t.name,"convertFile"),o=1048576,n=4,{res:r}=await a.multipartUpload(l,t.raw,{parallel:n,partSize:o});Object(i.b)("文件上传阿里云返回",r),200==r.status?e({url:r.requestUrls[0],key:l}):s()}catch(t){s(t)}}))},setFileStatus(t,e){let s="";"ready"==e?s="准备好":"uploading"==e?s="上传中":"failed"==e?s="转换失败":"success"==e?s="已完成":"uploaded"==e?s="已上传":"convert"==e?s="转换中":("error"==e||"limit"==e)&&(s="错误");const i=this.fileList.findIndex((e=>e.uid===t.uid));-1!==i&&this.$set(this.fileList,i,{...this.fileList[i],statusText:s,status:e})},resetConvert(){this.fileList=[],this.converting=!1,this.convertDone=!1,this.count=0,this.convertTimer={},this.taskTimer={},this.$refs.uploader.clearFiles()},downloadConvertedFile(t){const e=this.fileList.findIndex((e=>e.uid===t.uid));if(-1!==e)if(this.$set(this.fileList[e],"downloading",!0),this.type!==n.a.FILE||"png"!==t.format&&"jpg"!==t.format){(async t=>{const e=await fetch(t);return await e.blob()})(t.result_path).then((s=>{const i=document.createElement("a");i.style.display="none",i.href=URL.createObjectURL(s),i.download=`${Object(o.e)(t.name)}.${t.format}`,document.body.appendChild(i),i.click(),document.body.removeChild(i),this.$set(this.fileList[e],"downloading",!1)}))}else window.location.href=t.result_path}}}},1970:function(t,e,s){t.exports={}},1973:function(t,e,s){t.exports={}},2290:function(t,e,s){"use strict";s(1970)},2293:function(t,e,s){"use strict";s(1973)},2643:function(t,e,s){"use strict";s.r(e);var i=s(0),a=Object(i.a)({},(function(){var t=this,e=t._self._c;return e("svg",t._g({attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",width:"30",height:"30",viewBox:"0 0 30 30"}},t.$listeners),[e("defs",[e("clipPath",{attrs:{id:"desc_1_svg__a"}},[e("rect",{attrs:{width:"30",height:"30",rx:"0"}})])]),e("g",{attrs:{"clip-path":"url(#desc_1_svg__a)"}},[e("path",{attrs:{d:"M11.705 4.328L9.937 2.561 3.75 8.748l6.188 6.188 1.767-1.768-3.17-3.17H25v-2.5H8.535l3.17-3.17zm14.545 16.92l-6.188-6.187-1.767 1.767 3.17 3.17H5v2.5h16.465l-3.17 3.17 1.767 1.768 6.188-6.188z","fill-rule":"evenodd",fill:"#F1B651"}})])])}),[],!1,null,null,null).exports,l=Object(i.a)({},(function(){var t=this,e=t._self._c;return e("svg",t._g({attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",width:"30",height:"30",viewBox:"0 0 30 30"}},t.$listeners),[e("defs",[e("clipPath",{attrs:{id:"desc_2_svg__a"}},[e("rect",{attrs:{width:"30",height:"30",rx:"0"}})])]),e("g",{attrs:{"clip-path":"url(#desc_2_svg__a)"}},[e("path",{attrs:{d:"M16.25 3.819v6.806h8.125L14.158 26.219c.278.02.559.031.842.031 6.213 0 11.25-5.037 11.25-11.25h2.5c0 7.594-6.156 13.75-13.75 13.75-.807 0-1.598-.07-2.367-.203l-.133.203v-.227a13.757 13.757 0 01-8.943-5.897l-.579 1.087-2.206-1.176 2.88-5.404L4.686 19.5A11.272 11.272 0 0012.5 25.97v-7.846H5.625l9.048-14.37C8.611 3.928 3.75 8.896 3.75 15h-2.5C1.25 7.406 7.406 1.25 15 1.25c.41 0 .816.018 1.217.053l.033-.053v.056c3.81.343 7.17 2.24 9.443 5.05.219-.41.46-.859.704-1.319l2.206 1.176c-.433.814-.852 1.596-1.162 2.175l-1.573 2.928-1.122-1.94a11.253 11.253 0 00-8.496-5.557zM15 15.625h-4.847l3.597-5.712v3.212h5.998L15 20.372v-4.747z","fill-rule":"evenodd",fill:"#F1B651"}})])])}),[],!1,null,null,null).exports,o=Object(i.a)({},(function(){var t=this,e=t._self._c;return e("svg",t._g({attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",width:"30",height:"30",viewBox:"0 0 30 30"}},t.$listeners),[e("defs",[e("clipPath",{attrs:{id:"desc_3_svg__a"}},[e("rect",{attrs:{width:"30",height:"30",rx:"0"}})])]),e("g",{attrs:{"clip-path":"url(#desc_3_svg__a)"}},[e("path",{attrs:{d:"M28.75 6.25h-5v-5H1.25v22.5h5v5h22.5V6.25zm-7.5-2.5H3.75v17.5h2.5v-15h15v-2.5zm5 22.5V8.75H8.75v17.5h17.5zM15.04 14.408c-.659.427-1.12.992-1.305 1.589l-2.387-.744c.398-1.278 1.304-2.276 2.329-2.942 1.024-.665 2.258-1.061 3.448-1.061a6.23 6.23 0 014.375 1.787c.251-.282.516-.571.741-.796l1.768 1.768c-.278.278-.67.717-1.009 1.107l-.418.487-.123.146-.033.04-.01.012-1.146 1.373-.896-1.548a3.748 3.748 0 00-3.249-1.876c-.66 0-1.427.23-2.086.658zm-2.052 2.991l.699 1.6a3.751 3.751 0 003.438 2.251c1.25 0 2.567-.854 3.71-2.568l2.08 1.386c-1.357 2.036-3.338 3.682-5.79 3.682a6.237 6.237 0 01-4.853-2.311l-.804.734-1.686-1.846 3.206-2.928z","fill-rule":"evenodd",fill:"#F1B651"}})])])}),[],!1,null,null,null).exports,n=Object(i.a)({},(function(){var t=this,e=t._self._c;return e("svg",t._g({attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",width:"30",height:"30",viewBox:"0 0 30 30"}},t.$listeners),[e("defs",[e("clipPath",{attrs:{id:"desc_4_svg__a"}},[e("rect",{attrs:{width:"30",height:"30",rx:"0"}})])]),e("g",{attrs:{"clip-path":"url(#desc_4_svg__a)"}},[e("path",{attrs:{d:"M1.25 26.984l-2.134 2.134 1.768 1.768 3.384-3.384H28.75V3.02L30.884.886 29.116-.882l-3.384 3.384H1.25v24.482zm5.518-1.982H26.25V5.52l-4.42 4.42a5.625 5.625 0 01-2.455 10.687H16.25V15.52l-2.2 2.2.879 2.49-2.358.833-.48-1.363-5.323 5.322zm6.36-9.895l3.122-3.123V9.377h2.607l4.375-4.375H3.75v19.482l3.503-3.503-2.182-.77 3.75-10.625h2.358l1.948 5.52zm-5.57 5.569l.459-1.3h.84l-1.299 1.3zM18.75 13.02v5.107h.625a3.125 3.125 0 00.481-6.213L18.75 13.02zm-8.75.738l1.1 3.119H8.9l1.1-3.12z","fill-rule":"evenodd",fill:"#F1B651"}})])])}),[],!1,null,null,null).exports,r={components:{Desc1:a,Desc2:l,Desc3:o,Desc4:n},props:{type:{type:Number,default:1},levelUp:{type:Function,default:null},onClose:{type:Function,default:null}},data:()=>({slowLoad:!1,descList:[{icon:a,desc:"无损格式转换"},{icon:l,desc:"闪电转换"},{icon:o,desc:"批量转换"},{icon:n,desc:"纯洁无广告"},{title:"初级版",desc:"20个/月"},{title:"高级版",desc:"50个/月"},{title:"企业版",desc:"100个/月"}]}),mounted(){setTimeout((()=>{this.slowLoad=!0}),100)},methods:{handleClose(){this.onClose&&this.onClose()},handleUpVip(){this.levelUp?this.levelUp():window.open("/pricing?type=2","_blank"),setTimeout((()=>{this.handleClose()}),100)}}},c=(s(2290),Object(i.a)(r,(function(){var t=this,e=t._self._c;return e("el-dialog",{attrs:{width:1===t.type?"460px":"550px","custom-class":t.slowLoad?"show slow_load":"slow_load",visible:!0,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{close:t.handleClose}},[1===t.type?e("div",{staticClass:"flex items-center px-7.5 pt-8 pb-0 mb-6",attrs:{slot:"title"},slot:"title"},[e("i",{staticClass:"el-icon-warning-outline text-2xl mr-2",staticStyle:{color:"#faad14"}}),t._v(" "),e("span",{staticClass:"text-normal-c333 text-lg"},[t._v("提示")])]):t._e(),t._v(" "),1===t.type?e("div",[e("p",{staticClass:"text-normal-c333 text-sm px-7.5 mb-10"},[t._v("当前功能的使用量已达到每月数量上限，请先升级会员。")]),t._v(" "),e("div",{staticClass:"flex justify-end items-center pr-5 pb-5"},[e("dashboard-sqrcode-formmgt-button",{staticClass:"mr-2.5",on:{click:t.handleClose}},[t._v("\n        取消\n      ")]),t._v(" "),e("dashboard-sqrcode-formmgt-button",{attrs:{type:"primary"},on:{click:t.handleUpVip}},[t._v("\n        升级会员\n      ")])],1)]):t._e(),t._v(" "),2===t.type?e("div",{staticClass:"flex flex-col items-center pt-16 pb-13"},[e("p",{staticClass:"text-center text-xl text-normal-c333 font-semibold mb-2"},[t._v("普通版仅可转换3个文件")]),t._v(" "),e("p",{staticClass:"text-center text-sm text-normal-c999"},[t._v("开通VIP可畅享全部功能特权")]),t._v(" "),e("div",{staticClass:"flex flex-wrap mt-7.5"},t._l(t.descList,(function(s,i){return e("div",{key:i,staticClass:"item flex flex-col justify-center items-center"},[s.icon?e(s.icon,{tag:"component",staticClass:"icon-img mb-3.5"}):e("div",{staticClass:"text-base font-bold mb-3.5",staticStyle:{color:"#f1b551"}},[t._v("\n          "+t._s(s.title)+"\n        ")]),t._v(" "),e("div",{staticClass:"text-sm text-normal-c999"},[t._v(t._s(s.desc))])],1)})),0),t._v(" "),e("div",{staticClass:"open-btn rounded-md flex justify-center items-center text-base mt-6 cursor-pointer",on:{click:t.handleUpVip}},[e("img",{staticClass:"w-4.5 h-4.5 mr-2",attrs:{src:s(236),alt:""}}),t._v(" "),e("span",[t._v("开通VIP")])])]):t._e()])}),[],!1,null,"0aaeb408",null));e.default=c.exports;installComponents(c,{DashboardSqrcodeFormmgtButton:s(28).default})}}]);